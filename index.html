<head>
     <title>microCMSで取得したデータをテンプレートエンジンを使って表示する</title>
   </head>

   <body>

     <div class="l-container">
       <h1 class="ttl-news">お知らせ</h1>
       <p class="txt-leader">このページは<a href="https://microcms.io/" target="_blank" rel="noopener">microCMS</a>を使った「お知らせ」のサンプルページです。</p>

       <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
       <script>
         $(document).ready(function() {
           //========================
           //【ページングに必要な情報】

           //★1ページに表示したい記事の数
           const limit = 5;

           const page =
             parseInt(new URLSearchParams(window.location.search).get("page")) || 1;
           const offset = limit * (page - 1);
           //========================

           //microCMSからコンテンツ取得
           fetch(
             //★設定した項目
               `https://cayemanfan.microcms.io/api/v1/blogs?fields=title,image01&limit=${limit}&offset=${offset}`,
               {
                 headers: {
                   //★APIキー
                   "X-API-KEY": "5951b73985eb44e7b26cea3ec0fc0d837691"
                 }
               }
             )
             .then(response => response.json())
             .then(json => {
               for (const content of json.contents) {
                 //タイトル
                 const title = "<h2>" + content.title + "</h2>";

                 //画像1
                 const img01 = content.image01 && content.image01.url;
                 const disp_img01 = img01 && "<img src='" + img01 + "?w=300'>";

                 //表示部分
                 $("#content").append(
                   '<article class="article">' +
                   title +
                   (disp_img01 || "") +
                   "</article>"
                 );
               }

               //========================
               //ページング
               const totalCount = json.totalCount;
               const pageCount = Math.ceil(totalCount / limit);
               const pager = `<ul class='pager'>${
               //前のページリンクを表示
               page >= 2
                 ? `<li><a href='./index.html?page=${page -
                     1}'>前のページへ</a></li>`
                 : ""
             }${
               //必要なページを表示
               Array.from(Array(pageCount))
                 .map((noValue, index) => {
                   const targetPage = index + 1;
                   return targetPage === page
                     ? `<li><span>${index + 1}</span></li>`
                     : `<li><a href='./index.html?page=${index + 1}'>${index +
                         1}</a></li>`;
                 })
                 .join("\n")
             }${
               //次のページリンクを表示
               page < pageCount
                 ? `<li><a href='./index.html?page=${page +
                     1}'>次のページへ</a></li>`
                 : ""
             }</ul>`;
               $("#content").append(pager);
               //========================
             })
             .catch(e => {
               console.log(e.message);
             });
         });
       </script>

       <div id="content"></div>


     </div>

   </body>

 </html>
